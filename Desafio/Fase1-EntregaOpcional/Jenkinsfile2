pipeline {
    agent any
    parameters {
        string(name: 'TAG_KEY', defaultValue: 'Environment', description: 'Clave de la etiqueta para filtrar instancias EC2')
        choice(name: 'TAG_VALUE', choices: ['DAI', 'ONETEAM'], description: 'Valor de la etiqueta para filtrar instancias EC2')
        string(name: 'S3_BUCKET', defaultValue: 'tu-bucket-de-s3', description: 'Nombre del bucket de S3')
    }
    environment {
        AWS_DEFAULT_REGION = "us-east-1" // Ajusta seg√∫n sea necesario
        PYTHON_SCRIPT_PATH = './Desafio/Fase1-EntregaOpcional/script.py' // Ruta del script Python
    }
    stages {
        stage('Run Python Script') {
            steps {
                withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'UserJenkins-AWS', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                    script {
                        def tagKey = params.TAG_KEY
                        def tagValue = params.TAG_VALUE
                        def s3Bucket = params.S3_BUCKET
                        
                        sh """
                        #!/bin/bash
                        TAG_KEY=${tagKey}
                        TAG_VALUE=${tagValue}
                        S3_BUCKET=${s3Bucket}
                        
                        # Ejecutar el script Python
                        python3 ${env.PYTHON_SCRIPT_PATH} --tag-key \$TAG_KEY --tag-value \$TAG_VALUE --s3-bucket \$S3_BUCKET --region ${env.AWS_DEFAULT_REGION}
                        """
                    }
                }
            }
        }
    }
}
